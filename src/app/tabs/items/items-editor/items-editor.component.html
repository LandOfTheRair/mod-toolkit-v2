@let editingData = editing();

<div role="tablist" class="tabs tabs-boxed rounded-none mb-3">

  @for(tab of tabs; let i = $index; track tab.name) {
  <a role="tab" class="tab" [class.tab-active]="activeTab() === i" (click)="changeTab(i)">
    {{ tab.name }}
  </a>
  }

  <div class="tab flex flex-row justify-end">
    <button class="btn-sm btn btn-warning mr-3" (click)="doBack()">Go Back</button>
    <button class="btn-sm btn btn-secondary" [disabled]="!canSave()" (click)="doSave()">Save</button>
  </div>

</div>

@switch (activeTab()) {
@case (0) {
<div class="flex flex-row gap-2">
  <div class="form-column">
    <div class="form-row">
      <app-input-sprite [(sprite)]="editingData.sprite"></app-input-sprite>
    </div>

    <div class="form-row">
      <app-input-floating-label>Name</app-input-floating-label>
      <input [ngModel]="editingData.name" type="text" placeholder="Choose name..." class="form-input"
        (ngModelChange)="update('name', $event)" />
    </div>

    <div class="form-row">
      <app-input-itemclass [itemClass]="editingData.itemClass" label="Item Class"
        (change)="changeItemClass($event)"></app-input-itemclass>
    </div>

    <div class="form-row split">
      <div class="form-column">
        <app-input-skill [(skill)]="editingData.type" label="Primary Skill"></app-input-skill>
      </div>

      <div class="form-column">
        <app-input-skill [(skill)]="editingData.secondaryType" label="Secondary Skill (optional)"></app-input-skill>
      </div>
    </div>

    <div class="form-row split">
      <div class="form-column">
        <div class="form-row">
          <app-input-floating-label>Max # Of Upgrades</app-input-floating-label>
          <input [(ngModel)]="editingData.maxUpgrades" type="number" min="0" placeholder="Choose max #..."
            class="form-input" />
        </div>
      </div>

      <div class="form-column">
        <div class="form-row">
          <app-input-floating-label># of ★</app-input-floating-label>
          <input [(ngModel)]="editingData.quality" type="number" min="0" max="5" placeholder="Choose ★ #..."
            class="form-input" />
        </div>
      </div>
    </div>

    <div class="form-row split">
      <div class="form-column">
        <div class="form-row">
          <app-input-floating-label>Shop Purchase Cost</app-input-floating-label>
          <input [(ngModel)]="editingData.value" type="number" min="0" placeholder="Enter cost..." class="form-input" />
        </div>
      </div>

      <div class="form-column">
        <div class="form-row">
          <app-input-floating-label>Sell Value</app-input-floating-label>
          <input [(ngModel)]="editingData.sellValue" type="number" min="0" placeholder="Enter value..."
            class="form-input" />
        </div>
      </div>
    </div>

    <div class="form-row split">
      <div class="form-column">
        <div class="form-row">
          <label class="label cursor-pointer" floatUi="Whether or not the item is sackable.">
            <input type="checkbox" [(ngModel)]="editingData.isSackable" class="checkbox" />
            <span class="label-text">Sackable</span>
          </label>
        </div>
      </div>

      <div class="form-column">
        <div class="form-row">
          <label class="label cursor-pointer" floatUi="Whether or not the item is beltable.">
            <input type="checkbox" [(ngModel)]="editingData.isBeltable" class="checkbox" />
            <span class="label-text">Beltable</span>
          </label>
        </div>
      </div>
    </div>

    <div class="form-row split">
      <div class="form-column">
        <div class="form-row">
          <label class="label cursor-pointer" floatUi="Whether or not the item binds when picked up.">
            <input type="checkbox" [(ngModel)]="editingData.binds" class="checkbox" />
            <span class="label-text">Binds</span>
          </label>
        </div>
      </div>

      <div class="form-column">
        <div class="form-row">
          <label class="label cursor-pointer"
            floatUi="Whether or not the item puts a message in chat when bound (and picked up).">
            <input type="checkbox" [(ngModel)]="editingData.tellsBind" class="checkbox" />
            <span class="label-text">Tells Bind</span>
          </label>
        </div>
      </div>
    </div>

    <div class="form-row split">
      <div class="form-column">
        <div class="form-row">
          <label class="label cursor-pointer"
            floatUi="Whether or not the item is destroyed when put on the ground (dangerous!).">
            <input type="checkbox" [(ngModel)]="editingData.destroyOnDrop" class="checkbox" />
            <span class="label-text">Destroy on Drop</span>
          </label>
        </div>
      </div>

      <div class="form-column">
      </div>
    </div>

    <div class="form-row">
      <app-input-floating-label>Description</app-input-floating-label>
      <input [(ngModel)]="editingData.desc" type="text" placeholder="Enter description..." class="form-input" />
    </div>

    <div class="form-row">
      <app-input-floating-label>Sense Description (optional)</app-input-floating-label>
      <input [(ngModel)]="editingData.extendedDesc" type="text" placeholder="Enter sense description..."
        class="form-input" />
    </div>

    <div class="form-row">
      You are looking at {{ editingData.desc }}.
    </div>
  </div>

  <div class="form-column">
    <div class="form-row split">

      <div class="form-column">
        <div class="form-row">
          <app-input-stat [(stat)]="currentStat"></app-input-stat>
        </div>
      </div>

      <div class="form-column">
        <div class="form-row w-full flex justify-end">
          <button class="btn btn-accent btn-sm" [disabled]="!currentStat() || doesItemHaveCurrentStat()"
            (click)="addStat(currentStat())">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor" class="size-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    @for(stat of statsInOrder(); track $index) {

    <div class="form-row split">
      @if(stat.type === 'set') {
      <div class="form-column">
        <div class="form-row">
          <app-input-floating-label>{{ stat.stat }}</app-input-floating-label>
          <input [(ngModel)]="stat.set" type="number" placeholder="Choose value..." class="form-input" />
        </div>
      </div>
      }

      @if(stat.type === 'minmax') {
      <div class="form-column">
        <div class="form-row">
          <app-input-floating-label>{{ stat.stat }} min</app-input-floating-label>
          <input [(ngModel)]="stat.min" type="number" placeholder="Choose min..." class="form-input" />
        </div>
      </div>

      <div class="form-column">
        <div class="form-row">
          <app-input-floating-label>{{ stat.stat }} max</app-input-floating-label>
          <input [(ngModel)]="stat.max" type="number" placeholder="Choose max..." class="form-input" />
        </div>
      </div>
      }

      <div class="form-column">
        <div class="form-row w-full flex justify-end">
          <button class="btn btn-info btn-sm" (click)="toggleStat(stat)">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor" class="size-6">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M7.5 21 3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5" />
            </svg>
          </button>

          <button class="ml-1 btn btn-error btn-sm" (click)="removeStat(stat.stat)">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor" class="size-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14" />
            </svg>
          </button>
        </div>
      </div>
    </div>
    }
  </div>

  <div class="form-column">
    @for(prop of extraProps(); track $index) {

    @switch(propTypes[prop]) {
    @case('string') {
    <div class="form-row">
      <app-input-floating-label>{{ prop }}</app-input-floating-label>
      <input [(ngModel)]="editingData[prop]" type="text" placeholder="Pick..." class="form-input" />
    </div>
    }

    @case('number') {
    <div class="form-row">
      <app-input-floating-label>{{ prop }}</app-input-floating-label>
      <input [(ngModel)]="editingData[prop]" type="number" min="0" placeholder="Pick..." class="form-input" />
    </div>
    }

    @case('boolean') {
    <div class="form-row">
      <label class="label cursor-pointer">
        <input type="checkbox" [(ngModel)]="editingData[prop]" class="checkbox" />
        <span class="label-text">{{ prop }}</span>
      </label>
    </div>
    }

    @case('damageClass') {
    <div class="form-row">
      <app-input-damageclass [(damageClass)]="editingData.damageClass"></app-input-damageclass>
    </div>
    }

    @case('succorInfo') {
    <div class="form-row split">
      <div class="form-column">
        <div class="form-row">
          <app-input-floating-label>Succor Map</app-input-floating-label>
          <input [(ngModel)]="editingData.succorInfo!.map" type="text" placeholder="Pick..." class="form-input" />
        </div>
      </div>
      <div class="form-column">
        <div class="form-row">
          <app-input-floating-label>Succor X</app-input-floating-label>
          <input [(ngModel)]="editingData.succorInfo!.x" type="number" placeholder="Pick..." class="form-input" />
        </div>
      </div>
      <div class="form-column">
        <div class="form-row">
          <app-input-floating-label>Succor Y</app-input-floating-label>
          <input [(ngModel)]="editingData.succorInfo!.y" type="number" placeholder="Pick..." class="form-input" />
        </div>
      </div>
    </div>
    }

    @case('containedItems') {
    <div class="form-row split">
      <div class="form-column">
        <div class="form-row">
          <app-input-item [(item)]="currentItem"></app-input-item>
        </div>
      </div>

      <div class="form-column">
        <div class="form-row w-full flex justify-end">
          <button class="btn btn-accent btn-sm" (click)="addContainedItem()" [disabled]="!currentItem()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor" class="size-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    @for(item of editingData.containedItems; track $index) {
    <div class="form-row split">
      <div class="form-column">
        <div class="form-row pl-1">
          {{ item.result }}
        </div>
      </div>

      <div class="form-column">
        <div class="form-row">
          <app-input-floating-label>Roll Chance</app-input-floating-label>
          <input [(ngModel)]="item.chance" type="number" placeholder="Enter chance..." class="form-input" />
        </div>
      </div>

      <div class="form-column">
        <div class="form-row w-full flex justify-end">
          <button class="ml-1 btn btn-error btn-sm" (click)="removeContainedItem($index)">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor" class="size-6">
              <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14" />
            </svg>
          </button>
        </div>
      </div>
    </div>
    }
    }

    @default {
    {{ prop }} ({{ propTypes[prop] }}) has no editor.
    }
    }
    }
  </div>
</div>
}

@case (1) {

}

@case (2) {

}
}

<br>
{{ editingData | json }}
